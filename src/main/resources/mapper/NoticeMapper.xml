<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- JAVA와 연결할 Mapper 파일 설정 -->
<mapper namespace="kopo.poly.persistance.mapper.INoticeMapper">

    <!-- 게시판 리스트 쿼리 -->
    <select id="getNoticeList" resultType="NoticeDTO">
        SELECT N.POST_SEQ, N.POST_TITLE, N.POST_YN, N.POST_CNT, U.USER_NAME, N.USER_ID,
               DATE_FORMAT(N.REG_DT, '%Y-%m-%d') AS REG_DT
        FROM NOTICE N, USER_INFO U
        WHERE N.USER_ID = U.USER_ID
        ORDER BY N.POST_YN, N.REG_DT DESC
    </select>

    <!-- 게시판 등록 쿼리 -->
    <insert id="InsertNoticeInfo" parameterType="NoticeDTO">
        INSERT INTO NOTICE
        (
            POST_SEQ, POST_TITLE, POST_YN, POST_CONTENTS, USER_ID, POST_CNT,
            REG_ID, REG_DT, UPD_ID, UPD_DT
        )
        VALUES(
                      (SELECT NULLIF (MAX(A.POST_SEQ),0)+1 FROM NOTICE A),
                      #{post_title}, #{post_yn}, #{post_contents}, #{user_id}, 0, #{user_id}, SYSDATE(), #{user_id}, SYSDATE()
              )
    </insert>

    <!-- 게시판 상세보기 쿼리 -->
    <select id="getNoticeInfo" resultType="NoticeDTO">
        SELECT N.POST_SEQ, N.POST_TITLE, N.POST_YN, N.POST_CNT, U.USER_NAME, N.USER_ID,
               CONTENTS, DATE_FORMAT(N.REG_DT, '%Y-%m-%d') AS REG_DT
        FROM NOTICE N, USER_INFO U
        WHERE N.USER_ID = U.USER_ID
          AND N.POST_SEQ = #{post_seq}
    </select>



    <!-- 조회수 증가 쿼리 -->
    <update id="updateNoticeReadCnt" parameterType="NoticeDTO">
        UPDATE NOTICE SET
            POST_CNT = POST_CNT + 1
        WHERE
            POST_SEQ = #{post_seq}
    </update>

    <!-- 게시판 수정 쿼리 -->
    <update id="updateNoticeInfo" parameterType="NoticeDTO">
        UPDATE NOTICE SET
                          POST_TITLE = #{post_title},
                          POST_YN = #{post_yn},
                          POST_CONTENTS = #{post_contents},
                          UPD_ID = #{user_id},
                          UPD_DT = SYSDATE()
        WHERE
            POST_SEQ = #{post_seq}

    </update>

    <!-- 게시판 삭제 쿼리 -->
    <delete id="deleteNoticeInfo" parameterType="NoticeDTO">
        DELETE FROM NOTICE
        WHERE POST_SEQ = #{post_seq}

    </delete>

</mapper>